---

- name: Download NDelius application
  when: s3_dependencies_bucket is defined
  aws_s3:
    bucket: {{ s3_dependencies_bucket }}
    object: /dependencies/delius-core/NDelius-{{ ndelius_version }}/NDelius-ear-{{ ndelius_version | regex_replace("\.", "_") }}.ear
    dest: /u01/software/NDelius-ear-{{ ndelius_version | regex_replace("\.", "_") }}.ear
    mode: get

- name: Copy local NDelius application
  when: s3_dependencies_bucket is not defined
  copy:
    src: s3/dependencies/delius-core/NDelius-{{ ndelius_version }}/NDelius-ear-{{ ndelius_version | regex_replace("\.", "_") }}.ear
    dest: /u01/software/NDelius-ear-{{ ndelius_version | regex_replace("\.", "_") }}.ear
    owner: oracle
    group: oinstall
    mode: 0644

- name: Copy scripts
  copy:
    src: 'scripts/deploy_ndelius.py'
    dest: '/u01/software/deploy_ndelius.py'
    mode: '0644'
    owner: "oracle"
    group: "oinstall"

- name: Deploy NDelius application
  shell: '. ~/.bash_profile && ${WLS_HOME}/common/bin/wlst.sh /u01/software/deploy_ndelius.py NDelius-ear-{{ ndelius_version | regex_replace("\.", "_") }}.ear'
  become: yes
  become_user: "oracle"
